package com.example.bobgo;

import java.util.List;

import android.app.Activity;
import android.content.Intent;
import android.os.AsyncTask;
import android.os.Bundle;
import android.view.Menu;
import edu.handong.babgo.common.GlobalVariables;
import edu.handong.babgo.model.Message;
import edu.handong.babgo.util.PreferenceHelper;
import edu.handong.babgo.util.RequestHelper;

public class MainActivity extends Activity {
	int flag = 0;
	boolean DEBUG = false; 
	PreferenceHelper prefHelper;
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        prefHelper = new PreferenceHelper(MainActivity.this);
        
        if(DEBUG){
        /////////////////////////////////////
        Intent i = new Intent(MainActivity.this,TestDriverActivity.class);
        startActivity(i);
        /////////////////////////////////////
        
        }else{
        new AsyncTask<String,String,String>(){
        	List<Message> list = null;
        	@Override
        	protected void onPreExecute(){
        		
        	}
			@Override
			protected String doInBackground(String... arg0) {
				// TODO Auto-generated method stub
				RequestHelper helper = GlobalVariables.getRequestHelper();
				String id = prefHelper.getPhone();
				if("".equals(id)) return GlobalVariables.FAILED;
				list = helper.getNewUpdates(id);
				if(list == null) return GlobalVariables.FAILED;
				else if(list.size() == 0) return GlobalVariables.EMPTY;
				else return GlobalVariables.SUCCEED;
			}
			@Override
			protected void onPostExecute(String arg){
				Intent i;
				if(arg.equals(GlobalVariables.SUCCEED)){
					i = new Intent(MainActivity.this, MessageListActivity.class);
					GlobalVariables gv = GlobalVariables.getInstance();
					gv.setData("newUpdateList", list);
				}else{
					i = new Intent(MainActivity.this, MenuSelect.class);
				}
				i.putExtra(GlobalVariables.RESULT, arg);
		        startActivity(i);
			}
        }.execute("");
        }
        
    }
    
    @Override
    public void onResume(){
    	super.onResume();
    	flag++;
    	if(flag == 2)
    		finish();
    }

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        getMenuInflater().inflate(R.menu.activity_main, menu);
        return true;
    }
}
