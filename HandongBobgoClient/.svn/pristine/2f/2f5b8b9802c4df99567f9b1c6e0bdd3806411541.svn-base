package com.example.bobgo;

import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.MotionEvent;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.View.OnTouchListener;
import android.widget.Button;
import android.widget.EditText;
import edu.handong.babgo.common.GlobalVariables;
import edu.handong.babgo.model.Day;
import edu.handong.babgo.model.Partner;

public class SetMealActivity extends Activity {
	EditText breakfast;
	EditText lunch;
	EditText dinner;
	Button btnConfirm;
	int position;
	int flag = 0;
	@Override
    public void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_set_meal);
		
		breakfast = (EditText)findViewById(R.id.editTextBreakfast);
		lunch = (EditText)findViewById(R.id.editTextLunch);
		dinner = (EditText)findViewById(R.id.editTextDinner);
		btnConfirm = (Button)findViewById(R.id.btnConfirm);
		
		Intent i = getIntent();
		position = i.getIntExtra("position",0);
		String strBreakfast = i.getStringExtra("breakfast");
		String strLunch = i.getStringExtra("lunch");
		String strDinner = i.getStringExtra("dinner");
		
		breakfast.setText(strBreakfast);
		lunch.setText(strLunch);
		dinner.setText(strDinner);
		
		breakfast.setOnTouchListener(new OnTouchListener() {
			
			public boolean onTouch(View v, MotionEvent event) {
				// TODO Auto-generated method stub
				if(flag == 0){
					flag++;
					Intent i = new Intent(SetMealActivity.this,FriendMatching.class);
					i.putExtra("meal","breakfast");
					startActivityForResult(i, GlobalVariables.FROM_SET_SCHEDULE);
				}
				return false;
			}
		});
		
		lunch.setOnTouchListener(new OnTouchListener() {
			
			public boolean onTouch(View v, MotionEvent event) {
				// TODO Auto-generated method stub
				if(flag == 0){
					flag++;
					Intent i = new Intent(SetMealActivity.this,FriendMatching.class);
					i.putExtra("meal","lunch");
					startActivityForResult(i, GlobalVariables.FROM_SET_SCHEDULE);
				}
				return false;
			}
		});

		dinner.setOnTouchListener(new OnTouchListener() {
		
			public boolean onTouch(View v, MotionEvent event) {
				// TODO Auto-generated method stub
				if(flag == 0){
					flag++;
					Intent i = new Intent(SetMealActivity.this,FriendMatching.class);
					i.putExtra("meal","dinner");
					startActivityForResult(i, GlobalVariables.FROM_SET_SCHEDULE);
				}
				return false;
			}
		});
		
		
		btnConfirm.setOnClickListener(new OnClickListener() {
			
			public void onClick(View v) {
				// TODO Auto-generated method stub
				Partner partnerBreakfast = (Partner)GlobalVariables.getInstance().getData("partnerbreakfast");
				Partner partnerLunch = (Partner)GlobalVariables.getInstance().getData("partnerlunch");
				Partner partnerDinner = (Partner)GlobalVariables.getInstance().getData("partnerdinner");
				Day d = new Day();
				d.setBreakfast(partnerBreakfast != null && !breakfast.getText().toString().equals("") ? partnerBreakfast : new Partner());
				d.setLunch(partnerLunch != null && !lunch.getText().toString().equals("") ? partnerLunch : new Partner());
				d.setDinner(partnerDinner != null && !dinner.getText().toString().equals("") ? partnerDinner : new Partner());
				d.setDow(position);
				GlobalVariables.getInstance().setData("day"+position, d);
				
				Intent i = new Intent();
    			i.putExtra("position", position);
    			setResult(RESULT_OK, i);
				finish();
			}
		});
	}
	@Override
	public void onResume(){
		super.onResume();
		flag = 0;
	}
	
	@Override
	public void onActivityResult(int requestCode, int resultCode, Intent data){
		super.onActivityResult(requestCode, resultCode, data);
		
		if(resultCode == Activity.RESULT_OK){
			String meal = data.getStringExtra("meal");
			if(meal.equals("breakfast"))
				breakfast.setText(data.getStringExtra("name"));
			else if(meal.equals("lunch"))
				lunch.setText(data.getStringExtra("name"));
			else
				dinner.setText(data.getStringExtra("name"));
		}
		
	}
}
